{% extends "notes/base.html" %}

{% block title %}Edit Note{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <a href="{{ url_for('notes.view_note', note_id=note.id) }}" style="color: var(--primary); text-decoration: none; display: inline-flex; align-items: center; margin-bottom: 1rem;">
            ‚Üê Back to Note
        </a>
        
        <h1 style="color: var(--primary); margin-bottom: 1.5rem;">
            Edit Note
        </h1>
        
        <div class="card" style="background: rgba(10, 25, 47, 0.7); padding: 2rem;">
            <form method="POST" action="{{ url_for('notes.edit_note', note_id=note.id) }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="title" class="form-label">Title *</label>
                    <input type="text" id="title" name="title" class="form-control" 
                           value="{{ note.title }}" required>
                </div>
                
                <div class="form-group">
                    <label for="content" class="form-label">Content *</label>
                    <textarea id="content" name="content" class="form-control" rows="8" required>{{ note.content }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="unit_number" class="form-label">Unit Number (Optional)</label>
                    <input type="number" id="unit_number" name="unit_number" class="form-control" 
                           value="{{ note.unit_number if note.unit_number }}" min="1">
                </div>
                
                <div class="form-group">
                    <label for="tags" class="form-label">Tags (Optional)</label>
                    <input type="text" id="tags" name="tags" class="form-control" 
                           value="{{ note.tags if note.tags }}" placeholder="comma, separated, tags">
                    <small style="color: #8892b0; font-size: 0.9rem;">
                        Use commas to separate multiple tags (e.g., "contracts, torts, civil-procedure")
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="related_entries" class="form-label">Related Dictionary Entries (Optional)</label>
                    <input type="text" id="related_entries" name="related_entries" class="form-control" 
                           value="{{ note.related_entries if note.related_entries }}" placeholder="1, 5, 12">
                    <small style="color: #8892b0; font-size: 0.9rem;">
                        Enter the IDs of related dictionary entries, separated by commas
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="comments" class="form-label">Your Comments (Optional)</label>
                    <textarea id="comments" name="comments" class="form-control" rows="3">{{ note.comments if note.comments }}</textarea>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="is_favorite" name="is_favorite" value="1" 
                               {% if note.is_favorite %}checked{% endif %}>
                        <span>Mark as favorite</span>
                    </label>
                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">Worksheet Files</label>
                    
                    {% if note.worksheet_images %}
                        <div id="existing-worksheets" style="margin-bottom: 1rem;">
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                {% for worksheet in note.worksheet_images %}
                                    <div class="worksheet-file" style="
                                        background: rgba(100, 255, 218, 0.1); 
                                        padding: 0.5rem 1rem; 
                                        border-radius: 4px;
                                        display: flex;
                                        align-items: center;
                                        gap: 0.5rem;
                                        max-width: 100%;
                                    ">
                                        <span style="flex-shrink: 0;">üìÑ</span>
                                        <a href="{{ url_for('notes.serve_worksheet', filename=worksheet.filename) }}" 
                                           target="_blank" 
                                           style="color: var(--primary); 
                                                  text-decoration: none;
                                                  white-space: nowrap;
                                                  overflow: hidden;
                                                  text-overflow: ellipsis;
                                                  max-width: 200px;
                                                  display: inline-block;">
                                            {{ worksheet.original_filename }}
                                        </a>
                                        <form method="POST" 
                                              action="{{ url_for('notes.delete_worksheet', worksheet_id=worksheet.id) }}" 
                                              style="margin: 0; padding: 0; display: inline;"
                                              onsubmit="return confirm('Are you sure you want to delete this worksheet? This cannot be undone.');">
                                            <button type="submit" class="btn-icon" style="
                                                background: none;
                                                border: none;
                                                color: #ff6b6b;
                                                cursor: pointer;
                                                padding: 0.25rem;
                                                margin-left: 0.5rem;
                                                font-size: 1rem;
                                            ">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                    
                    <div>
                        <label for="worksheet_images" class="form-label">Add More Worksheets (Optional)</label>
                        <input type="file" id="worksheet_images" name="worksheet_images" class="form-control" multiple 
                               accept=".png,.jpg,.jpeg,.gif,.pdf,.doc,.docx,.txt">
                        <small style="color: #8892b0; font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                            Supported formats: PNG, JPG, GIF, PDF, DOC, DOCX, TXT
                        </small>
                        <div id="file-list" style="margin-top: 0.5rem;"></div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn" style="background: var(--primary); color: #000;">
                        Update Note
                    </button>
                    <a href="{{ url_for('notes.view_note', note_id=note.id) }}" class="btn" style="background: transparent; border: 1px solid var(--primary);">
                        Cancel
                    </a>
                </div>
                
                <script>
                // Show selected file names
                document.getElementById('worksheet_images').addEventListener('change', function(e) {
                    const fileList = document.getElementById('file-list');
                    fileList.innerHTML = '';
                    
                    if (this.files.length > 0) {
                        const list = document.createElement('div');
                        list.style.display = 'flex';
                        list.style.flexWrap = 'wrap';
                        list.style.gap = '0.5rem';
                        list.style.marginTop = '0.5rem';
                        
                        for (let i = 0; i < this.files.length; i++) {
                            const item = document.createElement('div');
                            item.style.display = 'flex';
                            item.style.alignItems = 'center';
                            item.style.padding = '0.3rem 0.8rem';
                            item.style.background = 'rgba(100, 255, 218, 0.1)';
                            item.style.borderRadius = '4px';
                            item.style.fontSize = '0.9rem';
                            
                            const icon = document.createElement('span');
                            icon.textContent = 'üìÑ';
                            icon.style.marginRight = '0.5rem';
                            
                            const fileName = document.createElement('span');
                            fileName.textContent = this.files[i].name;
                            fileName.style.whiteSpace = 'nowrap';
                            fileName.style.overflow = 'hidden';
                            fileName.style.textOverflow = 'ellipsis';
                            fileName.style.maxWidth = '200px';
                            
                            item.appendChild(icon);
                            item.appendChild(fileName);
                            list.appendChild(item);
                        }
                        
                        fileList.appendChild(list);
                    }
                });
                </script>
            </form>
        </div>
    </div>
</div>
{% endblock %}
